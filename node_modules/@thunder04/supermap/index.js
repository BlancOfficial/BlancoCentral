var o=Object.defineProperty;var f=a=>o(a,"__esModule",{value:true});var h=(a,e)=>o(a,"name",{value:e,configurable:true});f(exports);var l=Symbol("supermap.date_cache");var u=class extends Map{#e;[l]=null;#t=null;constructor(e={}){if("intervalTime"in e&&(!Number.isSafeInteger(e.intervalTime)||e.intervalTime<0))throw new TypeError("options.intervalTime must be a safe positive integer.");if("expireAfter"in e&&(!Number.isSafeInteger(e.expireAfter)||e.expireAfter<0))throw new TypeError("options.expireAfter must be a safe positive integer.");if("itemsLimit"in e&&(!Number.isSafeInteger(e.itemsLimit)||e.itemsLimit<0))throw new TypeError("options.itemsLimit must be a safe positive integer.");if("onSweep"in e&&typeof e.onSweep!=="function")throw new TypeError("options.onSweep must be a function.");e={expireAfter:0,itemsLimit:0,...e};super();this.#e=e;if("intervalTime"in e){this[l]=new Map;this.startInterval()}}toArray(){return Array.from(this.entries())}delete(e){return this[l]?.delete(e),super.delete(e)}set(e,i,r=0){if(!Number.isSafeInteger(r))throw new TypeError("ttl must be a safe integer");const t=this.#e.itemsLimit;if(t>0&&this.size>=t&&!this.has(e)){this.delete(this.first(true))}this[l]?.set(e,Date.now()+r);return super.set(e,i)}clear(e=false){if(e)this.stopInterval();else this[l]?.clear();return super.clear()}first(e){return e?this.keys().next().value:this.values().next().value}last(e=false){const i=this.entries();let r;while(true){const t=i.next();if(t.done)return r&&r[e?0:1];r=t.value}}some(e){const i=this.entries();while(true){const r=i.next();if(r.done)return false;if(e(r.value[1],r.value[0],this))return true}}every(e){const i=this.entries();while(true){const r=i.next();if(r.done)return true;if(!e(r.value[1],r.value[0],this))return false}}sweep(e){if(this.size===0)return-1;const i=this.#e.onSweep;const r=this.size;super.forEach((t,s)=>{if(e(t,s,this)){i?.(t,s);this.delete(s)}});return r-this.size}filter(e){const i=new u(this.#e);const r=this.entries();while(true){const t=r.next();if(t.done)return i;const[s,n]=t.value;if(e(n,s,this))i.set(s,n)}}map(e,i){return Array.from(this.#r(e,i))}find(e,i=false){const r=this.entries();while(true){const t=r.next();if(t.done)return null;const[s,n]=t.value;if(e(n,s,this))return i?s:n}}reduce(e,i){const r=this.entries();var t=i;while(true){const s=r.next();if(s.done)return t;t=e(t,s.value[1],s.value[0],this)}}concat(...e){const i=new u(this.#e);i[l]=this[l];for(const r of e.concat(this)){const t=r.entries();while(true){const s=t.next();if(s.done)break;i.set(...s.value)}}return i}concatMut(...e){for(const i of e){const r=i.entries();while(true){const t=r.next();if(t.done)break;this.set(...t.value)}}return this}sort(e){this.toArray().sort(([i,r],[t,s])=>e(r,s,i,t,this)).forEach(i=>this.set(...i));this.clear();return this}startInterval(){if(this[l]===null||!("intervalTime"in this.#e)){return false}this.stopInterval();this.#t=setInterval(()=>this.#i(),this.#e.intervalTime).unref();return true}stopInterval(){if(this[l]===null)return false;this[l].clear();if(this.#t!==null){clearInterval(this.#t);this.#t=null}return true}#i(){const e=this.entries(),i=this[l].entries();const r=Date.now()-this.#e.expireAfter;const t=this.#e.onSweep;while(true){const s=e.next();if(s.done)return;if(r>(i.next().value?.[1]||0)){const n=s.value[0];t?.(s.value[1],n);this.delete(n)}}}*#r(e,i){const r=this.entries();if(i){while(true){const t=r.next();if(t.done)return;const[s,n]=t.value;if(i(n,s,this)){yield e(n,s,this)}}}while(true){const t=r.next();if(t.done)return;yield e(t.value[1],t.value[0],this)}}};h(u,"SuperMap");module.exports=u;
